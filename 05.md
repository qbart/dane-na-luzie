# SQL w praktyce

## Najważniejsze konstrukcje SQL

- **SELECT** - projekcja danych (służy do określenia, co chcemy wyświetlić)
- **FROM** - źródło danych (określa główną tabelę)
- **JOIN** - łączenie informacji (umożliwia budowanie kontekstu z kilku tabel)
- **WHERE** - filtrowanie (zawężenia wyników)
- **GROUP BY + agregacje** - podsumowanie danych (pozwala na odpowiedzi typu "ile / które / w jakiej liczbie".)
- **ORDER BY** - sortowanie wyników (dla rankingów, list, analiz)
- **LIMIT / OFFSET** - ograniczanie wyników

## Podstawowe operacje

- SELECT
- INSERT
- UPDATE
- DELETE

```sql
-- pobranie 10 kursow posortowanych po nazwie
SELECT * FROM course ORDER BY name LIMIT 10;
```

```sql
-- pobranie lekcji z kursu o ID = 1
SELECT * FROM lesson WHERE course_id = 1;
```

```sql
-- dodanie kursu
INSERT INTO course (name, description)
  VALUES ('Yoga', 'Praktyka łącząca świadomy oddech z łagodnym ruchem');
```

```sql
-- aktualizacja ceny 199 i waluty dla kursu o ID = 1
UPDATE course SET price = 199.0, currency = 'PLN' WHERE id = 1;
```

```sql
-- usuniecie kursu o id = 1
DELETE FROM course WHERE id = 1;
```

## Ograniczenia

Każda tabela powinna mieć **przynajmniej 1 klucz główny** (`PRIMARY KEY`), które jednoznacznie identfikuje obiekt w tabeli.
Może to być wartość tworzona przez system, która nie ma znacznie biznesowego (tzw. surrogate key) lub klucz naturlany.

Przykłady identyfikatorów bez znaczenia biznesowego:
- 1, 2, 3, ...
- 7eaad914-971e-4973-92c7-047c606ea3f9, f2a06af8-c7a0-4211-8609-e4761e531990

Przykłady kluczy naturalnych:
- kody krajów: PL, DE, 
- PESEL
- ...

> [!TIP]
> Mimo kluczy naturalnych często używa się identyfikatorów nie mających znaczenia biznesowego.

## Dokumentacja

https://www.postgresql.org/docs/16/sql-select.html

## Chwila zabawy ✏️

1. Zaloguj się do pgAdmina
2. Stwórz swoją bazę danych.

```sql
-- zamien X na swoj numer usera
CREATE DATABASE lmsX;
```

3. Stwórz nowę połączenie na bazie danych (do bazy lmsX zamiast workshop).
4. Pracuj już na nowym połączeniu.
5. Stwórz podstawową strukturę:

```sql
CREATE TABLE course (
    id BIGSERIAL PRIMARY KEY,
    name TEXT NOT NULL
);

CREATE TABLE lesson (
    id BIGSERIAL PRIMARY KEY,
    course_id INTEGER NOT NULL REFERENCES course(id),
    name TEXT NOT NULL
);

CREATE TABLE enrollment (
    id BIGSERIAL PRIMARY KEY,
    email TEXT NOT NULL,
    course_id INTEGER NOT NULL REFERENCES course(id),
    enrolled_at TIMESTAMPTZ DEFAULT now()
);
```

6. Dodaj przykładowe dane do tabel:

```sql
INSERT INTO course (name) VALUES
  ('Yoga Flow'),
  ('Squash Basics'),
  ('Volleyball Essentials');

INSERT INTO lesson (course_id, name) VALUES
-- Yoga
(1, 'Breath & Balance'),
(1, 'Sun Salutation Sequence'),

-- Squash
(2, 'Grip & Footwork'),
(2, 'Serving Technique'),

-- Volleyball
(3, 'Setting Fundamentals'),
(3, 'Team Positioning');

INSERT INTO enrollment (email, course_id) VALUES
-- Yoga
('Anna@example.com', 1),
('Magda@example.com', 1),
('Kasia@example.com', 1),

-- Squash
('Julia@example.com', 2);
```

7. Przetestuj różne opcje SELECT / OFFSET / LIMIT / ORDER BY / WHERE na danych

## Łączenie tabel

Najczęściej będą nam potrzebne dwa typy JOINów: 
- INNER JOIN
- LEFT JOIN
